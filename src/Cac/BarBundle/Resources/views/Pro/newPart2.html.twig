{% extends '::base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ asset('css/jquery.Jcrop.min.css')}}">
{% endblock %}

{% block body %}



	<div class="formBar col-xs-12 col-sm-12 col-md-12 noPadding">
		<h1>Vendez du rêve</h1>
		<div class="separation1"></div>
		<div class="separation2"></div>
	</div>
	<div class="subtitlePageRegisterBig">
		<p>Vos photos</p>

	</div>
	<div class="file_button_container">

		{{ form_start(form) }}
    		{{ form_errors(form) }}

    		    {{ form_row(form.file) }}

    		    <div class="showImg">
    		    	<img id="blah" src="#" alt="Votre image" />
    		    </div>
                <input type="hidden" name="coords" id="coords" value="" data-ratio="">

    	{{ form_end(form) }}

	 </div>

	<a href="{{ path("promotion_create", {'id': id }) }}">Passer cette étape</a>

{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/jquery.color.js') }}" type="text/javascript" /></script>
    <script src="{{ asset('js/jquery.Jcrop.min.js') }}" type="text/javascript" /></script>
    <script>
    $(document).ready(function(){
        var jcrop_api = '';

        function readURL(input) {

            if (input.files && input.files[0]) {
                var reader = new FileReader();
                var img = new Image();
                
                reader.onload = function (e) {
                    if(jcrop_api != '') jcrop_api.destroy();
                    $('#blah').attr('src', e.target.result);

                    var image = $('#blah');
                    var oH = image.height(), oW = image.width();
                    var mW = $('.showImg').width();
                    var ratio = mW/oW;

                    if(ratio > 1) ratio = 1;
                    var cX = 1280*ratio, cY = 350*ratio;
                    var minSize = [cX, cY], setSelect = [(oW*ratio-cX)/2, (oH*ratio-cY)/2, cX, cY];

                    $('#blah').Jcrop({
                        onSelect: changeCoords,
                        minSize: minSize,
                        onChange: changeCoords,
                        setSelect: setSelect
                    }, function () { jcrop_api = this });
                    if(ratio < 1) {
                        $('#coords').attr('data-ratio', ratio);
                        var nH = oH*ratio;
                        $('.jcrop-holder, .jcrop-keymgr + img').height(nH);
                        $('.jcrop-holder div div img').width(mW).height(nH);
                    }
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        function changeCoords(c) {
            var ratio = $('#coords').attr('data-ratio');
            c.ratio = ratio;
            $('#coords').val(JSON.stringify(c));
        }

        $("#form_file").change(function(){
            readURL(this);
            $(".showImg").stop(true,true).show(300);
            $(".file_button_container img").stop(true,true).show(300);
        });
    });
    </script>
{% endblock %}
